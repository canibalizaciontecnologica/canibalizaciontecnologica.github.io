import{r as d,j as V}from"./react-Wu2nlj90.js";import{W as Ft,R as _t,O as We,P as Ne,S as Lt,a as Ee,V as Dt,b as Ht,B as zt,L as Wt,c as at,N as Nt,A as Bt,d as Ye,C as Vt,e as qt,U as Ut,f as J,g as ct,h as $t,i as Gt,T as Xt,D as Yt,j as Zt,H as Jt,k as Ze,l as Kt,F as Qt}from"./three-C7pc2rAH.js";import{j as en}from"./react-use-measure-DLYm2C2s.js";import{c as tn,x as nn,i as rn,m as on}from"./its-fine-DpVWcAnZ.js";import{c as ge,R as sn}from"./react-reconciler-DZnrQAoa.js";import{s as Je}from"./scheduler-DpnzcFAA.js";import{_ as Be}from"./@babel-CF3RwP-h.js";import{c as an}from"./react-dom-lQi1xorK.js";import{O as cn}from"./three-stdlib-CbdX0NA8.js";import{c as ln}from"./zustand-Bif17rXD.js";import{s as un,p as fn,c as dn}from"./suspend-react-BKIKQNXN.js";function lt(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const ut=e=>e&&e.isOrthographicCamera,pn=e=>e&&e.hasOwnProperty("current"),vn=e=>e!=null&&(typeof e=="string"||typeof e=="number"||e.isColor),de=((e,t)=>typeof window!="undefined"&&(((e=window.document)==null?void 0:e.createElement)||((t=window.navigator)==null?void 0:t.product)==="ReactNative"))()?d.useLayoutEffect:d.useEffect;function ft(e){const t=d.useRef(e);return de(()=>void(t.current=e),[e]),t}function mn(){const e=tn(),t=nn();return d.useMemo(()=>({children:n})=>{const o=!!rn(e,!0,s=>s.type===d.StrictMode)?d.StrictMode:d.Fragment;return V.jsx(o,{children:V.jsx(t,{children:n})})},[e,t])}function hn({set:e}){return de(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}const gn=(e=>(e=class extends d.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}},e.getDerivedStateFromError=()=>({error:!0}),e))();function dt(e){var t;const n=typeof window!="undefined"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}function re(e){var t;return(t=e.__r3f)==null?void 0:t.root.getState()}const F={obj:e=>e===Object(e)&&!F.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,nul:e=>e===null,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:o=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(F.str(e)||F.num(e)||F.boo(e))return e===t;const s=F.obj(e);if(s&&r==="reference")return e===t;const f=F.arr(e);if(f&&n==="reference")return e===t;if((f||s)&&e===t)return!0;let l;for(l in e)if(!(l in t))return!1;if(s&&n==="shallow"&&r==="shallow"){for(l in o?t:e)if(!F.equ(e[l],t[l],{strict:o,objects:"reference"}))return!1}else for(l in o?t:e)if(e[l]!==t[l])return!1;if(F.und(l)){if(f&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function bn(e){const t={nodes:{},materials:{},meshes:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material),n.isMesh&&!t.meshes[n.name]&&(t.meshes[n.name]=n)}),t}function yn(e){e.type!=="Scene"&&(e.dispose==null||e.dispose());for(const t in e){const n=e[t];(n==null?void 0:n.type)!=="Scene"&&(n==null||n.dispose==null||n.dispose())}}const pt=["children","key","ref"];function wn(e){const t={};for(const n in e)pt.includes(n)||(t[n]=e[n]);return t}function ye(e,t,n,r){const o=e;let s=o==null?void 0:o.__r3f;return s||(s={root:t,type:n,parent:null,children:[],props:wn(r),object:o,eventCount:0,handlers:{},isHidden:!1},o&&(o.__r3f=s)),s}function fe(e,t){let n=e[t];if(!t.includes("-"))return{root:e,key:t,target:n};n=e;for(const o of t.split("-")){var r;t=o,e=n,n=(r=n)==null?void 0:r[t]}return{root:e,key:t,target:n}}const Ke=/-\d+$/;function we(e,t){if(F.str(t.props.attach)){if(Ke.test(t.props.attach)){const o=t.props.attach.replace(Ke,""),{root:s,key:f}=fe(e.object,o);Array.isArray(s[f])||(s[f]=[])}const{root:n,key:r}=fe(e.object,t.props.attach);t.previousAttach=n[r],n[r]=t.object}else F.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function xe(e,t){if(F.str(t.props.attach)){const{root:n,key:r}=fe(e.object,t.props.attach),o=t.previousAttach;o===void 0?delete n[r]:n[r]=o}else t.previousAttach==null||t.previousAttach(e.object,t.object);delete t.previousAttach}const ke=[...pt,"args","dispose","attach","object","onUpdate","dispose"],Qe=new Map;function xn(e){let t=Qe.get(e.constructor);try{t||(t=new e.constructor,Qe.set(e.constructor,t))}catch{}return t}function jn(e,t){const n={};for(const r in t)if(!ke.includes(r)&&!F.equ(t[r],e.props[r])){n[r]=t[r];for(const o in t)o.startsWith(`${r}-`)&&(n[o]=t[o])}for(const r in e.props){if(ke.includes(r)||t.hasOwnProperty(r))continue;const{root:o,key:s}=fe(e.object,r);if(o.constructor&&o.constructor.length===0){const f=xn(o);F.und(f)||(n[s]=f[s])}else n[s]=0}return n}const Cn=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],Mn=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function Z(e,t){var n;const r=e.__r3f,o=r&&lt(r).getState(),s=r==null?void 0:r.eventCount;for(const l in t){let i=t[l];if(ke.includes(l))continue;if(r&&Mn.test(l)){typeof i=="function"?r.handlers[l]=i:delete r.handlers[l],r.eventCount=Object.keys(r.handlers).length;continue}if(i===void 0)continue;let{root:m,key:a,target:c}=fe(e,l);if(c instanceof Ye&&i instanceof Ye)c.mask=i.mask;else if(c instanceof Vt&&vn(i))c.set(i);else if(c!==null&&typeof c=="object"&&typeof c.set=="function"&&typeof c.copy=="function"&&i!=null&&i.constructor&&c.constructor===i.constructor)c.copy(i);else if(c!==null&&typeof c=="object"&&typeof c.set=="function"&&Array.isArray(i))typeof c.fromArray=="function"?c.fromArray(i):c.set(...i);else if(c!==null&&typeof c=="object"&&typeof c.set=="function"&&typeof i=="number")typeof c.setScalar=="function"?c.setScalar(i):c.set(i);else{var f;m[a]=i,o&&!o.linear&&Cn.includes(a)&&(f=m[a])!=null&&f.isTexture&&m[a].format===qt&&m[a].type===Ut&&(m[a].colorSpace=at)}}if(r!=null&&r.parent&&o!=null&&o.internal&&(n=r.object)!=null&&n.isObject3D&&s!==r.eventCount){const l=r.object,i=o.internal.interaction.indexOf(l);i>-1&&o.internal.interaction.splice(i,1),r.eventCount&&l.raycast!==null&&o.internal.interaction.push(l)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&ae(r),e}function ae(e){var t;if(!e.parent)return;e.props.onUpdate==null||e.props.onUpdate(e.object);const n=(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function En(e,t){e.manual||(ut(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix())}const z=e=>e==null?void 0:e.isObject3D;function me(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function vt(e,t,n,r){const o=n.get(t);o&&(n.delete(t),n.size===0&&(e.delete(r),o.target.releasePointerCapture(r)))}function Pn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(r=>r!==t),n.initialHits=n.initialHits.filter(r=>r!==t),n.hovered.forEach((r,o)=>{(r.eventObject===t||r.object===t)&&n.hovered.delete(o)}),n.capturedMap.forEach((r,o)=>{vt(n.capturedMap,t,r,o)})}function Sn(e){function t(i){const{internal:m}=e.getState(),a=i.offsetX-m.initialClick[0],c=i.offsetY-m.initialClick[1];return Math.round(Math.sqrt(a*a+c*c))}function n(i){return i.filter(m=>["Move","Over","Enter","Out","Leave"].some(a=>{var c;return(c=m.__r3f)==null?void 0:c.handlers["onPointer"+a]}))}function r(i,m){const a=e.getState(),c=new Set,h=[],g=m?m(a.internal.interaction):a.internal.interaction;for(let p=0;p<g.length;p++){const u=re(g[p]);u&&(u.raycaster.camera=void 0)}a.previousRoot||a.events.compute==null||a.events.compute(i,a);function P(p){const u=re(p);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var x;u.events.compute==null||u.events.compute(i,u,(x=u.previousRoot)==null?void 0:x.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(p,!0):[]}let R=g.flatMap(P).sort((p,u)=>{const x=re(p.object),C=re(u.object);return!x||!C?p.distance-u.distance:C.events.priority-x.events.priority||p.distance-u.distance}).filter(p=>{const u=me(p);return c.has(u)?!1:(c.add(u),!0)});a.events.filter&&(R=a.events.filter(R,a));for(const p of R){let u=p.object;for(;u;){var w;(w=u.__r3f)!=null&&w.eventCount&&h.push({...p,eventObject:u}),u=u.parent}}if("pointerId"in i&&a.internal.capturedMap.has(i.pointerId))for(let p of a.internal.capturedMap.get(i.pointerId).values())c.has(me(p.intersection))||h.push(p.intersection);return h}function o(i,m,a,c){if(i.length){const h={stopped:!1};for(const g of i){let P=re(g.object);if(P||g.object.traverseAncestors(R=>{const w=re(R);if(w)return P=w,!1}),P){const{raycaster:R,pointer:w,camera:p,internal:u}=P,x=new J(w.x,w.y,0).unproject(p),C=y=>{var O,j;return(O=(j=u.capturedMap.get(y))==null?void 0:j.has(g.eventObject))!=null?O:!1},b=y=>{const O={intersection:g,target:m.target};u.capturedMap.has(y)?u.capturedMap.get(y).set(g.eventObject,O):u.capturedMap.set(y,new Map([[g.eventObject,O]])),m.target.setPointerCapture(y)},v=y=>{const O=u.capturedMap.get(y);O&&vt(u.capturedMap,g.eventObject,O,y)};let A={};for(let y in m){let O=m[y];typeof O!="function"&&(A[y]=O)}let k={...g,...A,pointer:w,intersections:i,stopped:h.stopped,delta:a,unprojectedPoint:x,ray:R.ray,camera:p,stopPropagation(){const y="pointerId"in m&&u.capturedMap.get(m.pointerId);if((!y||y.has(g.eventObject))&&(k.stopped=h.stopped=!0,u.hovered.size&&Array.from(u.hovered.values()).find(O=>O.eventObject===g.eventObject))){const O=i.slice(0,i.indexOf(g));s([...O,g])}},target:{hasPointerCapture:C,setPointerCapture:b,releasePointerCapture:v},currentTarget:{hasPointerCapture:C,setPointerCapture:b,releasePointerCapture:v},nativeEvent:m};if(c(k),h.stopped===!0)break}}}return i}function s(i){const{internal:m}=e.getState();for(const a of m.hovered.values())if(!i.length||!i.find(c=>c.object===a.object&&c.index===a.index&&c.instanceId===a.instanceId)){const h=a.eventObject.__r3f;if(m.hovered.delete(me(a)),h!=null&&h.eventCount){const g=h.handlers,P={...a,intersections:i};g.onPointerOut==null||g.onPointerOut(P),g.onPointerLeave==null||g.onPointerLeave(P)}}}function f(i,m){for(let a=0;a<m.length;a++){const c=m[a].__r3f;c==null||c.handlers.onPointerMissed==null||c.handlers.onPointerMissed(i)}}function l(i){switch(i){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return m=>{const{internal:a}=e.getState();"pointerId"in m&&a.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{a.capturedMap.has(m.pointerId)&&(a.capturedMap.delete(m.pointerId),s([]))})}}return function(a){const{onPointerMissed:c,internal:h}=e.getState();h.lastEvent.current=a;const g=i==="onPointerMove",P=i==="onClick"||i==="onContextMenu"||i==="onDoubleClick",w=r(a,g?n:void 0),p=P?t(a):0;i==="onPointerDown"&&(h.initialClick=[a.offsetX,a.offsetY],h.initialHits=w.map(x=>x.eventObject)),P&&!w.length&&p<=2&&(f(a,h.interaction),c&&c(a)),g&&s(w);function u(x){const C=x.eventObject,b=C.__r3f;if(!(b!=null&&b.eventCount))return;const v=b.handlers;if(g){if(v.onPointerOver||v.onPointerEnter||v.onPointerOut||v.onPointerLeave){const A=me(x),k=h.hovered.get(A);k?k.stopped&&x.stopPropagation():(h.hovered.set(A,x),v.onPointerOver==null||v.onPointerOver(x),v.onPointerEnter==null||v.onPointerEnter(x))}v.onPointerMove==null||v.onPointerMove(x)}else{const A=v[i];A?(!P||h.initialHits.includes(C))&&(f(a,h.interaction.filter(k=>!h.initialHits.includes(k))),A(x)):P&&h.initialHits.includes(C)&&f(a,h.interaction.filter(k=>!h.initialHits.includes(k)))}}o(w,a,p,u)}}return{handlePointer:l}}const et=e=>!!(e!=null&&e.render),mt=d.createContext(null),Rn=(e,t)=>{const n=ln((l,i)=>{const m=new J,a=new J,c=new J;function h(p=i().camera,u=a,x=i().size){const{width:C,height:b,top:v,left:A}=x,k=C/b;u.isVector3?c.copy(u):c.set(...u);const y=p.getWorldPosition(m).distanceTo(c);if(ut(p))return{width:C/p.zoom,height:b/p.zoom,top:v,left:A,factor:1,distance:y,aspect:k};{const O=p.fov*Math.PI/180,j=2*Math.tan(O/2)*y,$=j*(C/b);return{width:$,height:j,top:v,left:A,factor:C/$,distance:y,aspect:k}}}let g;const P=p=>l(u=>({performance:{...u.performance,current:p}})),R=new ct;return{set:l,get:i,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(p=1)=>e(i(),p),advance:(p,u)=>t(p,u,i()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new $t,pointer:R,mouse:R,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const p=i();g&&clearTimeout(g),p.performance.current!==p.performance.min&&P(p.performance.min),g=setTimeout(()=>P(i().performance.max),p.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:h},setEvents:p=>l(u=>({...u,events:{...u.events,...p}})),setSize:(p,u,x=0,C=0)=>{const b=i().camera,v={width:p,height:u,top:x,left:C};l(A=>({size:v,viewport:{...A.viewport,...h(b,a,v)}}))},setDpr:p=>l(u=>{const x=dt(p);return{viewport:{...u.viewport,dpr:x,initialDpr:u.viewport.initialDpr||x}}}),setFrameloop:(p="always")=>{const u=i().clock;u.stop(),u.elapsedTime=0,p!=="never"&&(u.start(),u.elapsedTime=0),l(()=>({frameloop:p}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:d.createRef(),active:!1,frames:0,priority:0,subscribe:(p,u,x)=>{const C=i().internal;return C.priority=C.priority+(u>0?1:0),C.subscribers.push({ref:p,priority:u,store:x}),C.subscribers=C.subscribers.sort((b,v)=>b.priority-v.priority),()=>{const b=i().internal;b!=null&&b.subscribers&&(b.priority=b.priority-(u>0?1:0),b.subscribers=b.subscribers.filter(v=>v.ref!==p))}}}}}),r=n.getState();let o=r.size,s=r.viewport.dpr,f=r.camera;return n.subscribe(()=>{const{camera:l,size:i,viewport:m,gl:a,set:c}=n.getState();if(i.width!==o.width||i.height!==o.height||m.dpr!==s){o=i,s=m.dpr,En(l,i),m.dpr>0&&a.setPixelRatio(m.dpr);const h=typeof HTMLCanvasElement!="undefined"&&a.domElement instanceof HTMLCanvasElement;a.setSize(i.width,i.height,h)}l!==f&&(f=l,c(h=>({viewport:{...h.viewport,...h.viewport.getCurrentViewport(l)}})))}),n.subscribe(l=>e(l)),n};function ht(){const e=d.useContext(mt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function W(e=n=>n,t){return ht()(e,t)}function Ve(e,t=0){const n=ht(),r=n.getState().internal.subscribe,o=ft(e);return de(()=>r(o,t,n),[t,r,n]),null}const tt=new WeakMap,On=e=>{var t;return typeof e=="function"&&(e==null||(t=e.prototype)==null?void 0:t.constructor)===e};function gt(e,t){return function(n,...r){let o;return On(n)?(o=tt.get(n),o||(o=new n,tt.set(n,o))):o=n,e&&e(o),Promise.all(r.map(s=>new Promise((f,l)=>o.load(s,i=>{z(i==null?void 0:i.scene)&&Object.assign(i,bn(i.scene)),f(i)},t,i=>l(new Error(`Could not load ${s}: ${i==null?void 0:i.message}`))))))}}function bt(e,t,n,r){const o=Array.isArray(t)?t:[t],s=un(gt(n,r),[e,...o],{equal:F.equ});return Array.isArray(t)?s:s[0]}bt.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return fn(gt(n),[e,...r])};bt.clear=function(e,t){const n=Array.isArray(t)?t:[t];return dn([e,...n])};function Tn(e){const t=sn(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:d.version}),t}const yt=0,se={},In=/^three(?=[A-Z])/,Ce=e=>`${e[0].toUpperCase()}${e.slice(1)}`;let An=0;const kn=e=>typeof e=="function";function Fn(e){if(kn(e)){const t=`${An++}`;return se[t]=e,t}else Object.assign(se,e)}function wt(e,t){const n=Ce(e),r=se[n];if(e!=="primitive"&&!r)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(e==="primitive"&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(t.args!==void 0&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function _n(e,t,n){var r;return e=Ce(e)in se?e:e.replace(In,""),wt(e,t),e==="primitive"&&(r=t.object)!=null&&r.__r3f&&delete t.object.__r3f,ye(t.object,n,e,t)}function Ln(e){if(!e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?xe(e.parent,e):z(e.object)&&(e.object.visible=!1),e.isHidden=!0,ae(e)}}function xt(e){if(e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?we(e.parent,e):z(e.object)&&e.props.visible!==!1&&(e.object.visible=!0),e.isHidden=!1,ae(e)}}function qe(e,t,n){const r=t.root.getState();if(!(!e.parent&&e.object!==r.scene)){if(!t.object){var o,s;const f=se[Ce(t.type)];t.object=(o=t.props.object)!=null?o:new f(...(s=t.props.args)!=null?s:[]),t.object.__r3f=t}if(Z(t.object,t.props),t.props.attach)we(e,t);else if(z(t.object)&&z(e.object)){const f=e.object.children.indexOf(n==null?void 0:n.object);if(n&&f!==-1){const l=e.object.children.indexOf(t.object);if(l!==-1){e.object.children.splice(l,1);const i=l<f?f-1:f;e.object.children.splice(i,0,t.object)}else t.object.parent=e.object,e.object.children.splice(f,0,t.object),t.object.dispatchEvent({type:"added"}),e.object.dispatchEvent({type:"childadded",child:t.object})}else e.object.add(t.object)}for(const f of t.children)qe(t,f);ae(t)}}function Pe(e,t){t&&(t.parent=e,e.children.push(t),qe(e,t))}function nt(e,t,n){if(!t||!n)return;t.parent=e;const r=e.children.indexOf(n);r!==-1?e.children.splice(r,0,t):e.children.push(t),qe(e,t,n)}function jt(e){if(typeof e.dispose=="function"){const t=()=>{try{e.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT!="undefined"?t():Je.unstable_scheduleCallback(Je.unstable_IdlePriority,t)}}function Fe(e,t,n){if(!t)return;t.parent=null;const r=e.children.indexOf(t);r!==-1&&e.children.splice(r,1),t.props.attach?xe(e,t):z(t.object)&&z(e.object)&&(e.object.remove(t.object),Pn(lt(t),t.object));const o=t.props.dispose!==null&&n!==!1;for(let s=t.children.length-1;s>=0;s--){const f=t.children[s];Fe(t,f,o)}t.children.length=0,delete t.object.__r3f,o&&t.type!=="primitive"&&t.object.type!=="Scene"&&jt(t.object),n===void 0&&ae(t)}function Dn(e,t){for(const n of[e,e.alternate])if(n!==null)if(typeof n.ref=="function"){n.refCleanup==null||n.refCleanup();const r=n.ref(t);typeof r=="function"&&(n.refCleanup=r)}else n.ref&&(n.ref.current=t)}const be=[];function Hn(){for(const[n]of be){const r=n.parent;if(r){n.props.attach?xe(r,n):z(n.object)&&z(r.object)&&r.object.remove(n.object);for(const o of n.children)o.props.attach?xe(n,o):z(o.object)&&z(n.object)&&n.object.remove(o.object)}n.isHidden&&xt(n),n.object.__r3f&&delete n.object.__r3f,n.type!=="primitive"&&jt(n.object)}for(const[n,r,o]of be){n.props=r;const s=n.parent;if(s){var e,t;const f=se[Ce(n.type)];n.object=(e=n.props.object)!=null?e:new f(...(t=n.props.args)!=null?t:[]),n.object.__r3f=n,Dn(o,n.object),Z(n.object,n.props),n.props.attach?we(s,n):z(n.object)&&z(s.object)&&s.object.add(n.object);for(const l of n.children)l.props.attach?we(n,l):z(l.object)&&z(n.object)&&n.object.add(l.object);ae(n)}}be.length=0}const Se=()=>{},rt={};let he=yt;const zn=0,Wn=4,_e=Tn({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:_n,removeChild:Fe,appendChild:Pe,appendInitialChild:Pe,insertBefore:nt,appendChildToContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||Pe(n,t)},removeChildFromContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||Fe(n,t)},insertInContainerBefore(e,t,n){const r=e.getState().scene.__r3f;!t||!n||!r||nt(r,t,n)},getRootHostContext:()=>rt,getChildHostContext:()=>rt,commitUpdate(e,t,n,r,o){var s,f,l;wt(t,r);let i=!1;if((e.type==="primitive"&&n.object!==r.object||((s=r.args)==null?void 0:s.length)!==((f=n.args)==null?void 0:f.length)||(l=r.args)!=null&&l.some((a,c)=>{var h;return a!==((h=n.args)==null?void 0:h[c])}))&&(i=!0),i)be.push([e,{...r},o]);else{const a=jn(e,r);Object.keys(a).length&&(Object.assign(e.props,a),Z(e.object,a))}(o.sibling===null||(o.flags&Wn)===zn)&&Hn()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>e==null?void 0:e.object,prepareForCommit:()=>null,preparePortalMount:e=>ye(e.getState().scene,e,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:Ln,unhideInstance:xt,createTextInstance:Se,hideTextInstance:Se,unhideTextInstance:Se,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:d.createContext(null),setCurrentUpdatePriority(e){he=e},getCurrentUpdatePriority(){return he},resolveUpdatePriority(){var e;if(he!==yt)return he;switch(typeof window!="undefined"&&((e=window.event)==null?void 0:e.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ge.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ge.ContinuousEventPriority;default:return ge.DefaultEventPriority}},resetFormInstance(){}}),te=new Map,oe={objects:"shallow",strict:!1};function Nn(e,t){if(!t&&typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:n,height:r,top:o,left:s}=e.parentElement.getBoundingClientRect();return{width:n,height:r,top:o,left:s}}else if(!t&&typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...t}}function Bn(e){const t=te.get(e),n=t==null?void 0:t.fiber,r=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const o=typeof reportError=="function"?reportError:console.error,s=r||Rn(He,it),f=n||_e.createContainer(s,ge.ConcurrentRoot,null,!1,null,"",o,o,o,null);t||te.set(e,{fiber:f,store:s});let l,i,m=!1,a=null;return{async configure(c={}){let h;a=new Promise(E=>h=E);let{gl:g,size:P,scene:R,events:w,onCreated:p,shadows:u=!1,linear:x=!1,flat:C=!1,legacy:b=!1,orthographic:v=!1,frameloop:A="always",dpr:k=[1,2],performance:y,raycaster:O,camera:j,onPointerMissed:$}=c,M=s.getState(),_=M.gl;if(!M.gl){const E={canvas:e,powerPreference:"high-performance",antialias:!0,alpha:!0},S=typeof g=="function"?await g(E):g;et(S)?_=S:_=new Ft({...E,...g}),M.set({gl:_})}let T=M.raycaster;T||M.set({raycaster:T=new _t});const{params:X,...D}=O||{};if(F.equ(D,T,oe)||Z(T,{...D}),F.equ(X,T.params,oe)||Z(T,{params:{...T.params,...X}}),!M.camera||M.camera===i&&!F.equ(i,j,oe)){i=j;const E=j==null?void 0:j.isCamera,S=E?j:v?new We(0,0,0,0,.1,1e3):new Ne(75,0,.1,1e3);E||(S.position.z=5,j&&(Z(S,j),S.manual||("aspect"in j||"left"in j||"right"in j||"bottom"in j||"top"in j)&&(S.manual=!0,S.updateProjectionMatrix())),!M.camera&&!(j!=null&&j.rotation)&&S.lookAt(0,0,0)),M.set({camera:S}),T.camera=S}if(!M.scene){let E;R!=null&&R.isScene?(E=R,ye(E,s,"",{})):(E=new Lt,ye(E,s,"",{}),R&&Z(E,R)),M.set({scene:E})}w&&!M.events.handlers&&M.set({events:w(s)});const q=Nn(e,P);if(F.equ(q,M.size,oe)||M.setSize(q.width,q.height,q.top,q.left),k&&M.viewport.dpr!==dt(k)&&M.setDpr(k),M.frameloop!==A&&M.setFrameloop(A),M.onPointerMissed||M.set({onPointerMissed:$}),y&&!F.equ(y,M.performance,oe)&&M.set(E=>({performance:{...E.performance,...y}})),!M.xr){var N;const E=(L,Y)=>{const ce=s.getState();ce.frameloop!=="never"&&it(L,!0,ce,Y)},S=()=>{const L=s.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?E:null),L.gl.xr.isPresenting||He(L)},H={connect(){const L=s.getState().gl;L.xr.addEventListener("sessionstart",S),L.xr.addEventListener("sessionend",S)},disconnect(){const L=s.getState().gl;L.xr.removeEventListener("sessionstart",S),L.xr.removeEventListener("sessionend",S)}};typeof((N=_.xr)==null?void 0:N.addEventListener)=="function"&&H.connect(),M.set({xr:H})}if(_.shadowMap){const E=_.shadowMap.enabled,S=_.shadowMap.type;if(_.shadowMap.enabled=!!u,F.boo(u))_.shadowMap.type=Ee;else if(F.str(u)){var U;const H={basic:zt,percentage:Ht,soft:Ee,variance:Dt};_.shadowMap.type=(U=H[u])!=null?U:Ee}else F.obj(u)&&Object.assign(_.shadowMap,u);(E!==_.shadowMap.enabled||S!==_.shadowMap.type)&&(_.shadowMap.needsUpdate=!0)}return Gt.enabled=!b,m||(_.outputColorSpace=x?Wt:at,_.toneMapping=C?Nt:Bt),M.legacy!==b&&M.set(()=>({legacy:b})),M.linear!==x&&M.set(()=>({linear:x})),M.flat!==C&&M.set(()=>({flat:C})),g&&!F.fun(g)&&!et(g)&&!F.equ(g,_,oe)&&Z(_,g),l=p,m=!0,h(),this},render(c){return!m&&!a&&this.configure(),a.then(()=>{_e.updateContainer(V.jsx(Vn,{store:s,children:c,onCreated:l,rootElement:e}),f,null,()=>{})}),s},unmount(){Ct(e)}}}function Vn({store:e,children:t,onCreated:n,rootElement:r}){return de(()=>{const o=e.getState();o.set(s=>({internal:{...s.internal,active:!0}})),n&&n(o),e.getState().events.connected||o.events.connect==null||o.events.connect(r)},[]),V.jsx(mt.Provider,{value:e,children:t})}function Ct(e,t){const n=te.get(e),r=n==null?void 0:n.fiber;if(r){const o=n==null?void 0:n.store.getState();o&&(o.internal.active=!1),_e.updateContainer(null,r,null,()=>{o&&setTimeout(()=>{try{var s,f,l,i;o.events.disconnect==null||o.events.disconnect(),(s=o.gl)==null||(f=s.renderLists)==null||f.dispose==null||f.dispose(),(l=o.gl)==null||l.forceContextLoss==null||l.forceContextLoss(),(i=o.gl)!=null&&i.xr&&o.xr.disconnect(),yn(o.scene),te.delete(e)}catch{}},500)})}}const qn=new Set,Un=new Set,$n=new Set;function Re(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function ue(e,t){switch(e){case"before":return Re(qn,t);case"after":return Re(Un,t);case"tail":return Re($n,t)}}let Oe,Te;function Le(e,t,n){let r=t.clock.getDelta();t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Oe=t.internal.subscribers;for(let o=0;o<Oe.length;o++)Te=Oe[o],Te.ref.current(Te.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}let je=!1,De=!1,Ie,ot,ie;function Mt(e){ot=requestAnimationFrame(Mt),je=!0,Ie=0,ue("before",e),De=!0;for(const n of te.values()){var t;ie=n.store.getState(),ie.internal.active&&(ie.frameloop==="always"||ie.internal.frames>0)&&!((t=ie.gl.xr)!=null&&t.isPresenting)&&(Ie+=Le(e,ie))}if(De=!1,ue("after",e),Ie===0)return ue("tail",e),je=!1,cancelAnimationFrame(ot)}function He(e,t=1){var n;if(!e)return te.forEach(r=>He(r.store.getState(),t));(n=e.gl.xr)!=null&&n.isPresenting||!e.internal.active||e.frameloop==="never"||(t>1?e.internal.frames=Math.min(60,e.internal.frames+t):De?e.internal.frames=2:e.internal.frames=1,je||(je=!0,requestAnimationFrame(Mt)))}function it(e,t=!0,n,r){if(t&&ue("before",e),n)Le(e,n,r);else for(const o of te.values())Le(e,o.store.getState());t&&ue("after",e)}const Ae={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Gn(e){const{handlePointer:t}=Sn(e);return{priority:1,enabled:!0,compute(n,r,o){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(Ae).reduce((n,r)=>({...n,[r]:t(r)}),{}),update:()=>{var n;const{events:r,internal:o}=e.getState();(n=o.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(o.lastEvent.current)},connect:n=>{const{set:r,events:o}=e.getState();if(o.disconnect==null||o.disconnect(),r(s=>({events:{...s.events,connected:n}})),o.handlers)for(const s in o.handlers){const f=o.handlers[s],[l,i]=Ae[s];n.addEventListener(l,f,{passive:i})}},disconnect:()=>{const{set:n,events:r}=e.getState();if(r.connected){if(r.handlers)for(const o in r.handlers){const s=r.handlers[o],[f]=Ae[o];r.connected.removeEventListener(f,s)}n(o=>({events:{...o.events,connected:void 0}}))}}}}function Xn({ref:e,children:t,fallback:n,resize:r,style:o,gl:s,events:f=Gn,eventSource:l,eventPrefix:i,shadows:m,linear:a,flat:c,legacy:h,orthographic:g,frameloop:P,dpr:R,performance:w,raycaster:p,camera:u,scene:x,onPointerMissed:C,onCreated:b,...v}){d.useMemo(()=>Fn(Xt),[]);const A=mn(),[k,y]=en({scroll:!0,debounce:{scroll:50,resize:0},...r}),O=d.useRef(null),j=d.useRef(null);d.useImperativeHandle(e,()=>O.current);const $=ft(C),[M,_]=d.useState(!1),[T,X]=d.useState(!1);if(M)throw M;if(T)throw T;const D=d.useRef(null);de(()=>{const N=O.current;if(y.width>0&&y.height>0&&N){D.current||(D.current=Bn(N));async function U(){await D.current.configure({gl:s,scene:x,events:f,shadows:m,linear:a,flat:c,legacy:h,orthographic:g,frameloop:P,dpr:R,performance:w,raycaster:p,camera:u,size:y,onPointerMissed:(...E)=>$.current==null?void 0:$.current(...E),onCreated:E=>{E.events.connect==null||E.events.connect(l?pn(l)?l.current:l:j.current),i&&E.setEvents({compute:(S,H)=>{const L=S[i+"X"],Y=S[i+"Y"];H.pointer.set(L/H.size.width*2-1,-(Y/H.size.height)*2+1),H.raycaster.setFromCamera(H.pointer,H.camera)}}),b==null||b(E)}}),D.current.render(V.jsx(A,{children:V.jsx(gn,{set:X,children:V.jsx(d.Suspense,{fallback:V.jsx(hn,{set:_}),children:t!=null?t:null})})}))}U()}}),d.useEffect(()=>{const N=O.current;if(N)return()=>Ct(N)},[]);const q=l?"none":"auto";return V.jsx("div",{ref:j,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:q,...o},...v,children:V.jsx("div",{ref:k,style:{width:"100%",height:"100%"},children:V.jsx("canvas",{ref:O,style:{display:"block"},children:n})})})}function br(e){return V.jsx(on,{children:V.jsx(Xn,{...e})})}const pe=new J,Ue=new J,Yn=new J,st=new ct;function Zn(e,t,n){const r=pe.setFromMatrixPosition(e.matrixWorld);r.project(t);const o=n.width/2,s=n.height/2;return[r.x*o+o,-(r.y*s)+s]}function Jn(e,t){const n=pe.setFromMatrixPosition(e.matrixWorld),r=Ue.setFromMatrixPosition(t.matrixWorld),o=n.sub(r),s=t.getWorldDirection(Yn);return o.angleTo(s)>Math.PI/2}function Kn(e,t,n,r){const o=pe.setFromMatrixPosition(e.matrixWorld),s=o.clone();s.project(t),st.set(s.x,s.y),n.setFromCamera(st,t);const f=n.intersectObjects(r,!0);if(f.length){const l=f[0].distance;return o.distanceTo(n.ray.origin)<l}return!0}function Qn(e,t){if(t instanceof We)return t.zoom;if(t instanceof Ne){const n=pe.setFromMatrixPosition(e.matrixWorld),r=Ue.setFromMatrixPosition(t.matrixWorld),o=t.fov*Math.PI/180,s=n.distanceTo(r);return 1/(2*Math.tan(o/2)*s)}else return 1}function er(e,t,n){if(t instanceof Ne||t instanceof We){const r=pe.setFromMatrixPosition(e.matrixWorld),o=Ue.setFromMatrixPosition(t.matrixWorld),s=r.distanceTo(o),f=(n[1]-n[0])/(t.far-t.near),l=n[1]-f*t.far;return Math.round(f*s+l)}}const ze=e=>Math.abs(e)<1e-10?0:e;function Et(e,t,n=""){let r="matrix3d(";for(let o=0;o!==16;o++)r+=ze(t[o]*e.elements[o])+(o!==15?",":")");return n+r}const tr=(e=>t=>Et(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),nr=(e=>(t,n)=>Et(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function rr(e){return e&&typeof e=="object"&&"current"in e}const yr=d.forwardRef(({children:e,eps:t=.001,style:n,className:r,prepend:o,center:s,fullscreen:f,portal:l,distanceFactor:i,sprite:m=!1,transform:a=!1,occlude:c,onOcclude:h,castShadow:g,receiveShadow:P,material:R,geometry:w,zIndexRange:p=[16777271,0],calculatePosition:u=Zn,as:x="div",wrapperClass:C,pointerEvents:b="auto",...v},A)=>{const{gl:k,camera:y,scene:O,size:j,raycaster:$,events:M,viewport:_}=W(),[T]=d.useState(()=>document.createElement(x)),X=d.useRef(null),D=d.useRef(null),q=d.useRef(0),N=d.useRef([0,0]),U=d.useRef(null),E=d.useRef(null),S=(l==null?void 0:l.current)||M.connected||k.domElement.parentNode,H=d.useRef(null),L=d.useRef(!1),Y=d.useMemo(()=>c&&c!=="blending"||Array.isArray(c)&&c.length&&rr(c[0]),[c]);d.useLayoutEffect(()=>{const B=k.domElement;c&&c==="blending"?(B.style.zIndex=`${Math.floor(p[0]/2)}`,B.style.position="absolute",B.style.pointerEvents="none"):(B.style.zIndex=null,B.style.position=null,B.style.pointerEvents=null)},[c]),d.useLayoutEffect(()=>{if(D.current){const B=X.current=an.createRoot(T);if(O.updateMatrixWorld(),a)T.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const I=u(D.current,y,j);T.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${I[0]}px,${I[1]}px,0);transform-origin:0 0;`}return S&&(o?S.prepend(T):S.appendChild(T)),()=>{S&&S.removeChild(T),B.unmount()}}},[S,a]),d.useLayoutEffect(()=>{C&&(T.className=C)},[C]);const ce=d.useMemo(()=>a?{position:"absolute",top:0,left:0,width:j.width,height:j.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...f&&{top:-j.height/2,left:-j.width/2,width:j.width,height:j.height},...n},[n,s,f,j,a]),Pt=d.useMemo(()=>({position:"absolute",pointerEvents:b}),[b]);d.useLayoutEffect(()=>{if(L.current=!1,a){var B;(B=X.current)==null||B.render(d.createElement("div",{ref:U,style:ce},d.createElement("div",{ref:E,style:Pt},d.createElement("div",{ref:A,className:r,style:n,children:e}))))}else{var I;(I=X.current)==null||I.render(d.createElement("div",{ref:A,style:ce,className:r,children:e}))}});const ne=d.useRef(!0);Ve(B=>{if(D.current){y.updateMatrixWorld(),D.current.updateWorldMatrix(!0,!1);const I=a?N.current:u(D.current,y,j);if(a||Math.abs(q.current-y.zoom)>t||Math.abs(N.current[0]-I[0])>t||Math.abs(N.current[1]-I[1])>t){const K=Jn(D.current,y);let G=!1;Y&&(Array.isArray(c)?G=c.map(Q=>Q.current):c!=="blending"&&(G=[O]));const le=ne.current;if(G){const Q=Kn(D.current,y,$,G);ne.current=Q&&!K}else ne.current=!K;le!==ne.current&&(h?h(!ne.current):T.style.display=ne.current?"block":"none");const ve=Math.floor(p[0]/2),St=c?Y?[p[0],ve]:[ve-1,0]:p;if(T.style.zIndex=`${er(D.current,y,St)}`,a){const[Q,Ge]=[j.width/2,j.height/2],Me=y.projectionMatrix.elements[5]*Ge,{isOrthographicCamera:Xe,top:Rt,left:Ot,bottom:Tt,right:It}=y,At=tr(y.matrixWorldInverse),kt=Xe?`scale(${Me})translate(${ze(-(It+Ot)/2)}px,${ze((Rt+Tt)/2)}px)`:`translateZ(${Me}px)`;let ee=D.current.matrixWorld;m&&(ee=y.matrixWorldInverse.clone().transpose().copyPosition(ee).scale(D.current.scale),ee.elements[3]=ee.elements[7]=ee.elements[11]=0,ee.elements[15]=1),T.style.width=j.width+"px",T.style.height=j.height+"px",T.style.perspective=Xe?"":`${Me}px`,U.current&&E.current&&(U.current.style.transform=`${kt}${At}translate(${Q}px,${Ge}px)`,E.current.style.transform=nr(ee,1/((i||10)/400)))}else{const Q=i===void 0?1:Qn(D.current,y)*i;T.style.transform=`translate3d(${I[0]}px,${I[1]}px,0) scale(${Q})`}N.current=I,q.current=y.zoom}}if(!Y&&H.current&&!L.current)if(a){if(U.current){const I=U.current.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const{isOrthographicCamera:K}=y;if(K||w)v.scale&&(Array.isArray(v.scale)?v.scale instanceof J?H.current.scale.copy(v.scale.clone().divideScalar(1)):H.current.scale.set(1/v.scale[0],1/v.scale[1],1/v.scale[2]):H.current.scale.setScalar(1/v.scale));else{const G=(i||10)/400,le=I.clientWidth*G,ve=I.clientHeight*G;H.current.scale.set(le,ve,1)}L.current=!0}}}else{const I=T.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const K=1/_.factor,G=I.clientWidth*K,le=I.clientHeight*K;H.current.scale.set(G,le,1),L.current=!0}H.current.lookAt(B.camera.position)}});const $e=d.useMemo(()=>({vertexShader:a?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[a]);return d.createElement("group",Be({},v,{ref:D}),c&&!Y&&d.createElement("mesh",{castShadow:g,receiveShadow:P,ref:H},w||d.createElement("planeGeometry",null),R||d.createElement("shaderMaterial",{side:Yt,vertexShader:$e.vertexShader,fragmentShader:$e.fragmentShader})))});function or(e,t,n){const r=W(h=>h.size),o=W(h=>h.viewport),s=typeof e=="number"?e:r.width*o.dpr,f=r.height*o.dpr,l=(typeof e=="number"?n:e)||{},{samples:i=0,depth:m,...a}=l,c=d.useMemo(()=>{const h=new Zt(s,f,{minFilter:Ze,magFilter:Ze,type:Jt,...a});return m&&(h.depthTexture=new Kt(s,f,Qt)),h.samples=i,h},[]);return d.useLayoutEffect(()=>{c.setSize(s,f),i&&(c.samples=i)},[i,c,s,f]),d.useEffect(()=>()=>c.dispose(),[]),c}const ir=e=>typeof e=="function",wr=d.forwardRef(({envMap:e,resolution:t=256,frames:n=1/0,makeDefault:r,children:o,...s},f)=>{const l=W(({set:w})=>w),i=W(({camera:w})=>w),m=W(({size:w})=>w),a=d.useRef(null);d.useImperativeHandle(f,()=>a.current,[]);const c=d.useRef(null),h=or(t);d.useLayoutEffect(()=>{s.manual||(a.current.aspect=m.width/m.height)},[m,s]),d.useLayoutEffect(()=>{a.current.updateProjectionMatrix()});let g=0,P=null;const R=ir(o);return Ve(w=>{R&&(n===1/0||g<n)&&(c.current.visible=!1,w.gl.setRenderTarget(h),P=w.scene.background,e&&(w.scene.background=e),w.gl.render(w.scene,a.current),w.scene.background=P,w.gl.setRenderTarget(null),c.current.visible=!0,g++)}),d.useLayoutEffect(()=>{if(r){const w=i;return l(()=>({camera:a.current})),()=>l(()=>({camera:w}))}},[a,r,l]),d.createElement(d.Fragment,null,d.createElement("perspectiveCamera",Be({ref:a},s),!R&&o),d.createElement("group",{ref:c},R&&o(h.texture)))}),xr=d.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:r,enableDamping:o=!0,keyEvents:s=!1,onChange:f,onStart:l,onEnd:i,...m},a)=>{const c=W(v=>v.invalidate),h=W(v=>v.camera),g=W(v=>v.gl),P=W(v=>v.events),R=W(v=>v.setEvents),w=W(v=>v.set),p=W(v=>v.get),u=W(v=>v.performance),x=t||h,C=r||P.connected||g.domElement,b=d.useMemo(()=>new cn(x),[x]);return Ve(()=>{b.enabled&&b.update()},-1),d.useEffect(()=>(s&&b.connect(s===!0?C:s),b.connect(C),()=>void b.dispose()),[s,C,n,b,c]),d.useEffect(()=>{const v=y=>{c(),n&&u.regress(),f&&f(y)},A=y=>{l&&l(y)},k=y=>{i&&i(y)};return b.addEventListener("change",v),b.addEventListener("start",A),b.addEventListener("end",k),()=>{b.removeEventListener("start",A),b.removeEventListener("end",k),b.removeEventListener("change",v)}},[f,l,i,b,c,R]),d.useEffect(()=>{if(e){const v=p().controls;return w({controls:b}),()=>w({controls:v})}},[e,b]),d.createElement("primitive",Be({ref:a,object:b,enableDamping:o},m))});export{br as C,yr as H,xr as O,wr as P,bt as u};
